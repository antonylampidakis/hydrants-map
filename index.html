<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <title>Î§Î¬ÏÏ„Î·Ï‚ ÎšÏÎ¿Ï…Î½ÏÎ½</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header>
  <h1>Î§Î¬ÏÏ„Î·Ï‚ ÎºÏÎ¿Ï…Î½ÏÎ½</h1>

  <input id="file-xlsx" type="file" accept=".xlsx" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;">


  <img src="newlogos.png" alt="Î›Î¿Î³ÏŒÏ„Ï…Ï€Î¿" class="logo" />
</header>

<div class="wrap">
  <div id="map" class="card"></div>

  <div class="panel">
    <input id="search" class="search card" placeholder="Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏƒÎµ ÏŒÎ½Î¿Î¼Î±/ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·/ÏƒÏ„Î¿ÏÏ„Ï‚/Î´Î®Î¼Î¿/Ï†Ï‰Î»Î¹Î¬â€¦" />

    <div class="card filters">
      <div class="toolbar">
        <div class="toolbar-left">
          <label class="chip row1">
            <input type="checkbox" id="f-only-ok" />
            <span>ÎœÏŒÎ½Î¿ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ¿Î¯</span>
          </label>

          <label class="chip row1">
            <input type="checkbox" id="f-only-storts" />
            <span>ÎœÏŒÎ½Î¿ ÏŒÏƒÎ¿Î¹ Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ÏÏ„Ï‚</span>
          </label>

          <div class="row1"></div>

          <select id="f-cabinet" class="select-pill row2">
            <option value="">Î Ï…ÏÎ¿ÏƒÎ². Ï†Ï‰Î»Î¹Î¬: ÎŒÎ»ÎµÏ‚</option>
            <option value="ÎÎ±Î¹">ÎœÎµ Ï†Ï‰Î»Î¹Î¬</option>
            <option value="ÎŒÏ‡Î¹">Î§Ï‰ÏÎ¯Ï‚ Ï†Ï‰Î»Î¹Î¬</option>
          </select>

          <select id="f-muni" class="select-pill row2">
            <option value="">ÎŒÎ»Î¿Î¹ Î¿Î¹ Î´Î®Î¼Î¿Î¹</option>
          </select>

          <button id="btn-reset" class="pill pill-reset">â†º Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï†Î¯Î»Ï„ÏÏ‰Î½</button>
        </div>
      </div>
    </div>

    <div class="card list-title">
      Î›Î¯ÏƒÏ„Î± ÎºÏÎ¿Ï…Î½ÏÎ½ (<span id="list-count">0</span>)
    </div>

    <div id="list-card" class="card list-scroll">
      <table id="table">
        <thead>
          <tr>
            <th data-sort="name">ÎŒÎ½Î¿Î¼Î±</th>
            <th data-sort="status">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
            <th data-sort="lastInspection">Î•Ï€Î¹Î¸.</th>
            <th data-sort="storts">Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ÏÏ„Ï‚</th>
            <th data-sort="comments">Î£Ï‡ÏŒÎ»Î¹Î±</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <p id="empty" class="muted" style="display:none; padding:8px;">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎºÏÎ¿Ï…Î½Î¿Î¯â€¦</p>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// ---- Î¡Î¥Î˜ÎœÎ™Î£Î— API ----
const API_BASE = 'https://hydrants-api.onrender.com';

// ---- FETCH Î±Ï€ÏŒ API Î¼Îµ BBOX ----
let bboxTimer = null;

async function fetchHydrantsForBounds() {
  const b = map.getBounds();
  const minLat = b.getSouth();
  const minLon = b.getWest();
  const maxLat = b.getNorth();
  const maxLon = b.getEast();

  const u1 = `${API_BASE}/hydrants/bbox?minLon=${minLon}&minLat=${minLat}&maxLon=${maxLon}&maxLat=${maxLat}`;
  const u2 = `${API_BASE}/hydrants/bbox?minLng=${minLon}&minLat=${minLat}&maxLng=${maxLon}&maxLat=${maxLat}`;
  const u3 = `${API_BASE}/hydrants/bbox?bbox=${minLon},${minLat},${maxLon},${maxLat}`;
  const candidates = [u1, u2, u3];

  let lastError = null;

  for (const url of candidates) {
    try {
      debug('ÎšÎ±Î»Ï URL:', { url });
      const res = await fetch(url, { headers: { 'Accept': 'application/json' } });

      const ct = res.headers.get('content-type') || '';
      debug('Î‘Ï€ÏŒÎºÏÎ¹ÏƒÎ·:', { status: res.status, statusText: res.statusText, contentType: ct });

      if (!res.ok) {
        const txt = await res.text().catch(()=>'(no body)');
        lastError = new Error(`HTTP ${res.status}`);
        debug('ÎœÎ·-ÎŸÎš Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ· (sample):', txt.slice(0,200));
        continue;
      }

      if (!ct.includes('application/json')) {
        const txt = await res.text().catch(()=>'(no body)');
        debug('ÎœÎ·-JSON Î±Ï€ÏŒÎºÏÎ¹ÏƒÎ·:', txt.slice(0,200));
        continue;
      }

      const raw = await res.json();

      // --- Î‘Î½ GeoJSON ---
      if (raw && Array.isArray(raw.features)) {
        const data = raw.features.map(f => {
          const coords = f.geometry?.coordinates;
          const props = f.properties || {};
          const lng = Number(coords?.[0]);
          const lat = Number(coords?.[1]);
          if (!Number.isFinite(lat) || !Number.isFinite(lng)) return null;
          return {
            id: props.id ?? `${lat},${lng}`,
            name: props.name || 'ÎšÏÎ¿Ï…Î½ÏŒÏ‚',
            status: props.status || '',
            municipality: props.municipality || '',
            lastInspection: props.lastInspection || null,
            storts: props.storts ?? '',
            comments: props.comments ?? '',
            cabinet: props.cabinet ?? '',
            functional: (normalize(props.status) === "Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™ÎšÎŸÎ£"),
            needsStorts: !!props.needsStorts,
            lat, lng
          };
        }).filter(Boolean);

        debug('OK (GeoJSON) Ï†ÏŒÏÏ„Ï‰ÏƒÎ±:', { count: data.length });
        state.data = data; populateMuniFilter(state.data); applyAll();
        if (state.filtered[0]) selectHydrant(state.filtered[0].id,{fly:false});
        return;
      }

      // --- Î‘Î½ Î±Ï€Î»ÏŒ array ---
      if (Array.isArray(raw)) {
        const data = raw.map(h => {
          const lat = Number(h.lat ?? h.latitude);
          const lng = Number(h.lng ?? h.lon ?? h.longitude);
          if (!Number.isFinite(lat) || !Number.isFinite(lng)) return null;
          return {
            id: h.id ?? `${lat},${lng}`,
            name: h.name || h.code || 'ÎšÏÎ¿Ï…Î½ÏŒÏ‚',
            status: h.status || '',
            municipality: h.municipality || '',
            lastInspection: h.lastInspection || null,
            storts: h.storts ?? '',
            comments: h.comments ?? '',
            cabinet: h.cabinet ?? '',
            functional: (normalize(h.status) === "Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™ÎšÎŸÎ£"),
            needsStorts: !!h.needsStorts,
            lat, lng
          };
        }).filter(Boolean);

        debug('OK Ï†ÏŒÏÏ„Ï‰ÏƒÎ±:', { count: data.length });
        state.data = data; populateMuniFilter(state.data); applyAll();
        if (state.filtered[0]) selectHydrant(state.filtered[0].id,{fly:false});
        return;
      }

      // --- ÎœÎ· Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î· Î´Î¿Î¼Î® ---
      debug('ÎœÎ·-Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î· JSON:', JSON.stringify(raw).slice(0,200));
    } catch (err) {
      lastError = err;
      debug('Î£Ï†Î¬Î»Î¼Î± fetch:', String(err));
    }
  }

  debug('Î‘Ï€Î­Ï„Ï…Ï‡Î±Î½ ÏŒÎ»Î± Ï„Î± URLs', { tried: candidates, lastError: String(lastError) });
}




function scheduleBboxFetch() {
  if (bboxTimer) clearTimeout(bboxTimer);
  bboxTimer = setTimeout(fetchHydrantsForBounds, 300);
}



/* --- helpers --- */
const normalize = (s) => (s||"").toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase().trim();
const esc = (s)=>String(s ?? "-").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));

function statusClass(status){
  const s = normalize(status);
  if (s === "Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™ÎšÎŸÎ£") return "ok";
  if (s === "ÎœÎ• Î Î¡ÎŸÎ’Î›Î—ÎœÎ‘") return "faulty";
  if (s === "Î•ÎšÎ¤ÎŸÎ£ Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘Î£") return "unknown";
  return "unknown";
}
function formatDate(dateStr) {
  if (!dateStr) return "-";
  if (typeof dateStr === "string" && (/[?]/.test(dateStr) || /-00-00$/.test(dateStr))) return "-";
  const d = new Date(dateStr);
  if (isNaN(d)) return "-";
  const day = String(d.getDate()).padStart(2,"0");
  const month = String(d.getMonth()+1).padStart(2,"0");
  const year = d.getFullYear();
  return `${day}/${month}/${year}`;
}

/* --- Leaflet pin --- */
const hydrantEmojiIcon = L.divIcon({
  className: "emoji-pin",
  html: "ğŸ§¯",
  iconSize: [24, 24],
  iconAnchor: [12, 12],
  popupAnchor: [0, -12]
});

/* --- state --- */
let state = { data:[], filtered:[], selectedId:null, sortBy:"name", sortDir:"asc", markersById:new Map() };

/* --- map --- */
const map = L.map('map', { doubleClickZoom: false, closePopupOnClick: false }).setView([37.9838,23.7275], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

// Ï†ÏŒÏÏ„Ï‰ÏƒÎµ Î±ÏÏ‡Î¹ÎºÎ¬ ÎºÎ±Î¹ Î¼ÎµÏ„Î¬ ÏƒÎµ ÎºÎ¬Î¸Îµ pan/zoom
map.on('moveend', scheduleBboxFetch);
fetchHydrantsForBounds();

/* --- ui refs --- */
const tbody = document.getElementById('tbody');
const emptyEl = document.getElementById('empty');
const searchInput = document.getElementById('search');
const onlyOk = document.getElementById('f-only-ok');
const onlyStorts = document.getElementById('f-only-storts');
const btnReset = document.getElementById('btn-reset');
const listCount = document.getElementById('list-count');
const muniSelect = document.getElementById('f-muni');
const cabinetSelect = document.getElementById('f-cabinet');
const listCard = document.getElementById('list-card');
const toTopBtn = document.getElementById('to-top'); // Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼Î·Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹

/* --- events --- */
onlyOk.addEventListener('change',()=>{ if(onlyOk.checked) onlyStorts.checked=false; applyAll(); });
onlyStorts.addEventListener('change',()=>{ if(onlyStorts.checked) onlyOk.checked=false; applyAll(); });
searchInput.addEventListener('input',()=>applyAll());
muniSelect.addEventListener('change', applyAll);
cabinetSelect.addEventListener('change', applyAll);

btnReset.addEventListener('click',()=>{
  searchInput.value="";
  onlyOk.checked=false;
  onlyStorts.checked=false;
  muniSelect.value="";
  cabinetSelect.value="";
  applyAll();
});

/* click sort headers */
document.querySelectorAll('th[data-sort]').forEach(th=>{
  th.addEventListener('click',()=>{
    const key=th.getAttribute('data-sort');
    if(state.sortBy===key){ state.sortDir=state.sortDir==="asc"?"desc":"asc"; }
    else { state.sortBy=key; state.sortDir="asc"; }
    applyAll();
  });
});

/* --- "Î Î¬Î½Ï‰" guards --- */
function updateToTopVisibility(){
  if (!toTopBtn) return;
  const canScroll = listCard.scrollHeight > listCard.clientHeight + 10;
  const scrolled  = listCard.scrollTop > 120;
  toTopBtn.classList.toggle('show', canScroll && scrolled);
}
if (toTopBtn) {
  listCard.addEventListener('scroll', updateToTopVisibility);
  window.addEventListener('resize', updateToTopVisibility);
  toTopBtn.addEventListener('click', () => listCard.scrollTo({ top: 0, behavior: 'smooth' }));
}

/* --- renderers --- */
function renderTable(){
  tbody.innerHTML="";
  listCount.textContent = String(state.filtered.length);
  if(state.filtered.length===0){ emptyEl.style.display="block"; updateToTopVisibility(); return; }
  emptyEl.style.display="none";
  for(const h of state.filtered){
    const tr=document.createElement('tr');
    if(h.id===state.selectedId) tr.classList.add('active');
    tr.onclick=()=>selectHydrant(h.id,{fly:true});
    const badge = `<span class="badge ${statusClass(h.status)}">${esc(h.status)}</span>`;
    tr.innerHTML = `
      <td>${esc(h.name)}</td>
      <td class="status-cell">${badge}</td>
      <td>${formatDate(h.lastInspection)}</td>
      <td>${esc(h.storts)}</td>
      <td class="note">${esc(h.comments)}</td>
    `;
    tbody.appendChild(tr);
  }
  updateToTopVisibility();
}

function renderMarkers(){
  for (const [,m] of state.markersById) map.removeLayer(m);
  state.markersById.clear();
  for (const h of state.filtered){
    const marker = L.marker([h.lat, h.lng], { icon: hydrantEmojiIcon }).addTo(map);
    const html = `
      <b>${esc(h.name)}</b><br/>
      Î”Î®Î¼Î¿Ï‚: ${esc(h.municipality || "-")}<br/>
      ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: ${esc(h.status)}<br/>
      Î•Ï€Î¹Î¸.: ${formatDate(h.lastInspection)}<br/>
      Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ÏÏ„Ï‚: ${esc(h.storts)}<br/>
      Î Ï…ÏÎ¿ÏƒÎ². Ï†Ï‰Î»Î¹Î¬: ${esc(h.cabinet || "-")}<br/>
      Î£Ï‡ÏŒÎ»Î¹Î±: ${esc(h.comments)}
    `;
    marker.bindPopup(html, { autoPan: true });
    marker.on('click', (e) => {
      if (e && e.originalEvent) { e.originalEvent.preventDefault(); e.originalEvent.stopPropagation(); }
      selectHydrant(h.id, { fly: false });
      marker.openPopup();
    });
    state.markersById.set(h.id, marker);
  }
  updateToTopVisibility();
}

function selectHydrant(id, opts = {}) {
  state.selectedId = id;
  for (const tr of tbody.querySelectorAll('tr')) tr.classList.remove('active');
  const idx = state.filtered.findIndex(x => x.id === id);
  if (idx >= 0 && tbody.children[idx]) tbody.children[idx].classList.add('active');
  const h = state.data.find(x => x.id === id);
  if (!h) return;
  if (opts.fly !== false) map.flyTo([h.lat, h.lng], 16);
  const m = state.markersById.get(id);
  if (m) m.openPopup();
}

function applyAll(){
  const q = normalize(searchInput.value || "");
  const selectedMuni = muniSelect.value || "";
  const selectedCab  = cabinetSelect.value || "";

  let f = state.data.filter(h=>{
    const text = normalize(`${h.name||""} ${h.status||""} ${h.storts||""} ${h.comments||""} ${h.municipality||""} ${h.cabinet||""}`);
    if(q && !text.includes(q)) return false;
    if (onlyOk.checked && !h.functional) return false;
    if (onlyStorts.checked && !h.needsStorts) return false;
    if (selectedMuni && (h.municipality||"") !== selectedMuni) return false;
    if (selectedCab  && (h.cabinet||"")      !== selectedCab ) return false;
    return true;
  });

  const dir=state.sortDir==="asc"?1:-1;
  f.sort((a,b)=>{
    const k=state.sortBy;
    const va=(a[k]??"").toString().toLowerCase();
    const vb=(b[k]??"").toString().toLowerCase();
    if(va<vb) return -1*dir; if(va>vb) return 1*dir; return 0;
  });

  state.filtered=f; renderTable(); renderMarkers();
}

function init(data){
  state.data=data; applyAll();
  if(state.filtered[0]) selectHydrant(state.filtered[0].id,{fly:false});
  updateToTopVisibility();
}

/* --- Î´Î®Î¼Î¿Î¹ & Ï†Î¯Î»Ï„ÏÎ¿ --- */
const MUNICIPALITIES = [
  "Î Î±Ï€Î¬Î³Î¿Ï…","Î§Î¿Î»Î±ÏÎ³Î¿Ï","Î“Î­ÏÎ±ÎºÎ±","Î Î±Î»Î»Î®Î½Î·Ï‚","Î‘Î½Î¸Î¿ÏÏƒÎ±Ï‚","Î‘ÏÎ³Î¹Î¸Î­Î±Ï‚",
  "Î‘Î³Î¯Î±Ï‚ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®Ï‚","Î–Ï‰Î³ÏÎ¬Ï†Î¿Ï…","ÎšÎ±Î¹ÏƒÎ±ÏÎ¹Î±Î½Î®Ï‚","Î‘Î³. Î£Ï„Î­Ï†Î±Î½Î¿Ï…","Î†Î½Î¿Î¹Î¾Î·Ï‚",
  "Î”Î¹ÏŒÎ½Ï…ÏƒÎ¿Ï…","Î”ÏÎ¿ÏƒÎ¹Î¬Ï‚","ÎšÏÏ…Î¿Î½ÎµÏÎ¹Î¿Ï…","Î¡Î¿Î´ÏŒÏ€Î¿Î»Î·Ï‚","Î£Ï„Î±Î¼Î¬Ï„Î±","ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬Ï‚",
  "Î. Î•ÏÏ…Î¸ÏÎ±Î¯Î±Ï‚","Î•ÎºÎ¬Î»Î·Ï‚","Î§Î±Î»Î±Î½Î´ÏÎ¯Î¿Ï…","Î’ÏÏÏ‰Î½Î±","Î‘Î¸Î·Î½Î±Î¯Ï‰Î½","ÎÎ­Î¿Ï… Î¨Ï…Ï‡Î¹ÎºÎ¿Ï",
  "Î—Î»Î¹Î¿ÏÏ€Î¿Î»Î·Ï‚","Î“Î»Ï…Ï†Î¬Î´Î±Ï‚","Î¦Î¹Î»Î¿Î¸Î­Î·Ï‚","ÎœÎ±ÏÎºÏŒÏ€Î¿Ï…Î»Î¿Ï… ÎœÎµÏƒÎ¿Î³Î±Î¯Î±Ï‚","Î¡Î±Ï†Î®Î½Î±Ï‚",
  "ÎšÎ¿ÏÏ‰Ï€Î¯","Î Î±Î¹Î±Î½Î¯Î±Ï‚","Î£Ï€Î¬Ï„Ï‰Î½","Î§ÏÎ¹ÏƒÏ„Î¿ÏÏ€Î¿Î»Î·","Î‘Î¼Î±ÏÎ¿Ï…ÏƒÎ¯Î¿Ï…","Î’ÏÎ¹Î»Î®ÏƒÏƒÎ¹Ï‰Î½",
  "Î“Î±Î»Î±Ï„ÏƒÎ¯Î¿Ï…","Î‘ÏÏ„Î­Î¼Î¹Î´Î¿Ï‚","ÎšÎ±Î»Î»Î¹Ï„ÎµÏ‡Î½Î¿ÏÏ€Î¿Î»Î·","Î“Î»Ï…ÎºÏÎ½ ÎÎµÏÏÎ½","ÎšÎ±Î»ÏÎ²Î¹Ï‰Î½",
  "Î’Î¬ÏÎ·Ï‚","Î’Î¿Ï…Î»Î¹Î±Î³Î¼Î­Î½Î·Ï‚","ÎšÎ¯Ï„ÏƒÎ¹","Î†Î»Î¹Î¼Î¿Ï…","Î‘ÏÎ³Ï…ÏÎ¿ÏÏ€Î¿Î»Î·Ï‚","Î•Î»Î»Î·Î½Î¹ÎºÎ¿Ï","Î’Î¿ÏÎ»Î±Ï‚"
];
const _MUNI_MAP = new Map(MUNICIPALITIES.map(n => [normalize(n).replace(/\s+/g,' '), n]));
const MUNI_ALIASES = {
  "Î”Î—ÎœÎŸÎ£ Î‘Î˜Î—ÎÎ‘Î™Î©Î": "Î‘Î¸Î·Î½Î±Î¯Ï‰Î½",
  "ÎÎ•Î‘Î£ Î•Î¡Î¥Î˜Î¡Î‘Î™Î‘Î£": "Î. Î•ÏÏ…Î¸ÏÎ±Î¯Î±Ï‚",
  "Î Î•Î¡Î¥Î˜Î¡Î‘Î™Î‘Î£": "Î. Î•ÏÏ…Î¸ÏÎ±Î¯Î±Ï‚",
  "Î’Î¡Î™Î›Î—Î£Î£Î™Î©Î": "Î’ÏÎ¹Î»Î®ÏƒÏƒÎ¹Ï‰Î½",
  "ÎšÎ¡Î¥ÎŸÎÎ•Î¡Î™ÎŸÎ¥": "ÎšÏÏ…Î¿Î½ÎµÏÎ¹Î¿Ï…",
};
function canonMunicipality(v) {
  if (!v) return "";
  const raw = String(v).trim().replace(/^Î”(Î—|Î—ÎœÎŸÎ£|\.|Î—ÎœÎŸÎ¥)?\s*/i, "");
  const key = normalize(raw).replace(/\s+/g, " ");
  if (MUNI_ALIASES[key]) return MUNI_ALIASES[key];
  return _MUNI_MAP.get(key) || String(v).trim();
}
function populateMuniFilter(data){
  muniSelect.innerHTML = "";
  muniSelect.appendChild(new Option("ÎŒÎ»Î¿Î¹ Î¿Î¹ Î´Î®Î¼Î¿Î¹",""));
  for(const m of MUNICIPALITIES) muniSelect.appendChild(new Option(m,m));
  const known = new Set(MUNICIPALITIES);
  const extra = new Set();
  for(const h of data){
    const m = (h.municipality||"").trim();
    if(m && !known.has(m)) extra.add(m);
  }
  for(const m of [...extra].sort()) muniSelect.appendChild(new Option(m,m));
}
	
function debug(msg, obj) {
  let d = document.getElementById('debug');
  if (!d) {
    d = document.createElement('pre');
    d.id = 'debug';
    d.style.cssText = 'position:fixed;right:8px;bottom:8px;max-width:45vw;max-height:40vh;overflow:auto;background:#1e1e1e;color:#fff;padding:8px;border-radius:6px;z-index:99999;font:12px/1.35 monospace';
    document.body.appendChild(d);
  }
  d.textContent = [msg, obj ? JSON.stringify(obj, null, 2) : ''].join('\n');
}


</script>
</body>
</html>







